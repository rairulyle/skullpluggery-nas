---
services:
  watchtower:
    container_name: watchtower
    image: containrrr/watchtower:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${DEFAULT_VOLUME}/${APP_DATA}/watchtower/config.json:/config.json
    command: nginx-proxy-manager adguardhome adguardhome-sync speedtest-tracker jellyfin radarr sonarr prowlarr qbittorrent
    environment:
      WATCHTOWER_NOTIFICATIONS: shoutrrr
      WATCHTOWER_NOTIFICATION_URL: "discord://${DISCORD_TOKEN}@${DISCORD_ID}"
      WATCHTOWER_SCHEDULE: "0 0 * * *" # every 12:00 AM every day
    restart: unless-stopped

  nginx-proxy-manager:
    container_name: nginx-proxy-manager
    image: "jc21/nginx-proxy-manager:latest"
    ports:
      - "80:80"
      - "81:81"
      - "443:443"
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/nginx-proxy-manager/data:/data
      - ${DEFAULT_VOLUME}/${APP_DATA}/nginx-proxy-manager/letsencrypt:/etc/letsencrypt
    restart: unless-stopped

  adguardhome:
    container_name: adguardhome
    image: adguard/adguardhome:latest
    ports:
      - 53:53/tcp
      - 53:53/udp
      - 784:784/udp
      - 853:853/tcp
      - 3000:3000/tcp
      - 2080:80/tcp
      - 2443:443/tcp
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/adguardhome/work:/opt/adguardhome/work
      - ${DEFAULT_VOLUME}/${APP_DATA}/adguardhome/conf:/opt/adguardhome/conf
    restart: unless-stopped

  adguardhome-sync:
    container_name: adguardhome-sync
    image: lscr.io/linuxserver/adguardhome-sync:latest
    volumes:
      - "${DEFAULT_VOLUME}/${APP_DATA}/adguardsync:/config"
    ports:
      - 8082:8080
    restart: unless-stopped

  speedtest-tracker:
    container_name: speedtest-tracker
    image: "ghcr.io/alexjustesen/speedtest-tracker:latest"
    ports:
      - "8081:80"
      - "8443:443"
    environment:
      - PUID=1000
      - PGID=1000
      - DB_CONNECTION=pgsql
      - DB_HOST=speedtest-tracker-db
      - DB_PORT=5432
      - DB_DATABASE=speedtest_tracker
      - DB_USERNAME=speedy
      - DB_PASSWORD=password
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/speedtest-tracker/config:/config
      - ${DEFAULT_VOLUME}/${APP_DATA}/speedtest-tracker/etc/ssl/web:/etc/ssl/web
    restart: unless-stopped
    depends_on:
      - speedtest-tracker-db
  speedtest-tracker-db:
    container_name: speedtest-tracker-db
    image: postgres:15
    restart: always
    environment:
      - POSTGRES_DB=speedtest_tracker
      - POSTGRES_USER=speedy
      - POSTGRES_PASSWORD=password
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/speedtest-tracker/postgres:/var/lib/postgresql/data

  jellyfin:
    container_name: jellyfin
    image: lscr.io/linuxserver/jellyfin:latest
    ports:
      - 8096:8096
    group_add:
      - "110"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Manila
    devices:
      - /dev/dri:/dev/dri
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/jellyfin:/config
      - ${DEFAULT_VOLUME}/${DATA}/media:/data
    restart: unless-stopped

  radarr:
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Manila
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/radarr:/config
      - ${DEFAULT_VOLUME}/${DATA}:/data
    ports:
      - 7878:7878
    restart: unless-stopped

  sonarr:
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Manila
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/sonarr:/config
      - ${DEFAULT_VOLUME}/${DATA}:/data
    ports:
      - 8989:8989
    restart: unless-stopped

  prowlarr:
    container_name: prowlarr
    image: lscr.io/linuxserver/prowlarr:develop
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Manila
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/prowlarr:/config
    ports:
      - 9696:9696
    restart: unless-stopped

  qbittorrent:
    container_name: qbittorrent
    image: cr.hotio.dev/hotio/qbittorrent:release
    ports:
      - 8080:8080
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=Asia/Manila
    volumes:
      - ${DEFAULT_VOLUME}/${APP_DATA}/qbittorrent:/config
      - ${DEFAULT_VOLUME}/${DATA}/torrents:/data/torrents
    restart: unless-stopped
